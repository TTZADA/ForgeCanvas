"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=exports.CanvasUtil=exports.Colors=exports.hexRegex=exports.rgbaRegex=exports.fontRegex=void 0,exports.loadFrame=loadFrame,exports.parseArgs=parseArgs;const canvas_1=require("@napi-rs/canvas"),chalk_1=__importDefault(require("chalk")),__1=require(".."),gifsx_1=require("@gifsx/gifsx");exports.fontRegex=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\sa-z]+?)\s*$/i,exports.rgbaRegex=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(\s*,\s*(0|1|0?\.\d+))?\s*\)$/,exports.hexRegex=/^#?([0-9A-Fa-f]{3,4}){1,2}$/,exports.Colors={White:"#ffffff",Aqua:"#1abc9c",Green:"#57f287",Blue:"#3498db",Yellow:"#fee75c",Purple:"#9b59b6",LuminousVividPink:"#e91e63",Fuchsia:"#eb459e",Gold:"#f1c40f",Orange:"#e67e22",Red:"#ed4245",RubberDuck:"#FFD700",Grey:"#95a5a6",Navy:"#34495e",DarkAqua:"#11806a",DarkGreen:"#1f8b4c",DarkBlue:"#206694",DarkPurple:"#71368a",DarkVividPink:"#ad1457",DarkGold:"#c27c0e",DarkOrange:"#a84300",DarkRed:"#992d22",DarkGrey:"#979c9f",DarkerGrey:"#7f8c8d",LightGrey:"#bcc0c0",DarkNavy:"#2c3e50",Blurple:"#5865f2",Greyple:"#99aab5",DarkButNotBlack:"#2c2f33",NotQuiteBlack:"#23272a"},exports.CanvasUtil={isValidFont:e=>{if(!e)return!1;if(exports.fontRegex.test(e)){const s=exports.fontRegex.exec(e);if(s?.[0]){const t=s[6].split(",").map(r=>r?.trim());if(t){for(const r of t)if(!canvas_1.GlobalFonts.has(r.replace(/['',]/g,"")))return!1}return!0}return!1}return!1},parseStyle:async(e,s,t,r)=>{if(!r)return"#000000";let n=r.split("://");if(n[0]==="gradient"){const a=s.gradientManager?.get(n.slice(1).join("://"));if(!a)return e.customError("No gradient");n=a}else if(n[0]==="pattern"){const a=n.slice(1).join("://").split(":"),i=a.shift()?.toLowerCase(),c=a.length>0&&["repeat","repeat-x","repeat-y","no-repeat"].includes(a[a.length-1])?a.pop():null;let l;if(i==="canvas"){const o=s.canvasManager?.get(c?a.join(":"):a.join())?.ctx;if(!o)return e.customError("No canvas with provided name found.");l=o.getImageData(0,0,o.canvas.width,o.canvas.height)}else if(i==="image")if(a?.join(":")?.startsWith("images://")){const o=s?.imageManager?.get(a.join(":").slice(9));if(!o)return e.customError("No image with provided name found.");l=o}else l=await(0,canvas_1.loadImage)(c?a.join(":"):a.join());else return e.customError("Invalid pattern type.");n=t.ctx.createPattern(l,c)}else n=(exports.hexRegex.test(r)?r:exports.rgbaRegex.test(r)?(()=>{const a=r.match(exports.rgbaRegex);return(0,gifsx_1.rgbaToHex)(Uint8Array.from([Number.parseInt(a[1],10),Number.parseInt(a[2],10),Number.parseInt(a[3],10),a[5]?Number.parseFloat(a[5]):255]),!1,!0)})():exports.Colors[r])??"#000000";return n},calculateRectAlignOrBaseline:(e,s,t)=>(t=typeof t=="string"?__1.RectAlign[t]:t,t===__1.RectAlign.center?e-s/2:t===__1.RectAlign.right||t===__1.RectBaseline.top?e-s:e),parseFilters:e=>{const s=[],t=/([a-zA-Z-]+)\(([^)]+)\)/g;let r;for(;(r=t.exec(e))!==null;){const[n,a,i]=r;s.push({filter:a,value:i,raw:n})}return s}},exports.Logger={DateColor:chalk_1.default.green.bold,Colors:{INFO:chalk_1.default.cyan.bold,WARN:chalk_1.default.yellow.bold,ERROR:chalk_1.default.red.bold,MESSAGE:chalk_1.default.cyan.bold},log(e,s){console.log(this.DateColor(`[${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}]`),this.Colors[e](`[${e}]`),this.Colors.MESSAGE(s))}};async function loadFrame(e,s){const t=await(0,canvas_1.loadImage)(e),r=(0,canvas_1.createCanvas)(t.width,t.height),n=r.getContext("2d");return n.drawImage(t,0,0),gifsx_1.Frame.fromRgba(r.width,r.height,Uint8Array.from(n.getImageData(0,0,r.width,r.height).data),s)}function parseArgs(e,s,t,r){const n=e.slice(typeof s=="string"?s.length:s).split(":");if(r?n.length<t:n.length!==t)throw new Error(`${s} frame expects ${t} arguments.`);return n}
