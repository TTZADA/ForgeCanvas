"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Logger=exports.CanvasUtil=exports.Colors=exports.hexRegex=exports.rgbaRegex=exports.fontRegex=void 0,exports.loadFrame=loadFrame,exports.parseArgs=parseArgs;const canvas_1=require("@napi-rs/canvas"),chalk_1=__importDefault(require("chalk")),__1=require(".."),gifsx_1=require("@gifsx/gifsx");exports.fontRegex=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\sa-z]+?)\s*$/i,exports.rgbaRegex=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(\s*,\s*(0|1|0?\.\d+))?\s*\)$/,exports.hexRegex=/^#?([0-9A-Fa-f]{3,4}){1,2}$/,exports.Colors={White:"#ffffff",Aqua:"#1abc9c",Green:"#57f287",Blue:"#3498db",Yellow:"#fee75c",Purple:"#9b59b6",LuminousVividPink:"#e91e63",Fuchsia:"#eb459e",Gold:"#f1c40f",Orange:"#e67e22",Red:"#ed4245",RubberDuck:"#FFD700",Grey:"#95a5a6",Navy:"#34495e",DarkAqua:"#11806a",DarkGreen:"#1f8b4c",DarkBlue:"#206694",DarkPurple:"#71368a",DarkVividPink:"#ad1457",DarkGold:"#c27c0e",DarkOrange:"#a84300",DarkRed:"#992d22",DarkGrey:"#979c9f",DarkerGrey:"#7f8c8d",LightGrey:"#bcc0c0",DarkNavy:"#2c3e50",Blurple:"#5865f2",Greyple:"#99aab5",DarkButNotBlack:"#2c2f33",NotQuiteBlack:"#23272a"},exports.CanvasUtil={isValidFont:e=>{if(!e)return!1;if(exports.fontRegex.test(e)){const o=exports.fontRegex.exec(e);if(o?.[0]){const r=o[6].split(",").map(t=>t?.trim());if(r){for(const t of r)if(!canvas_1.GlobalFonts.has(t.replace(/['',]/g,"")))return!1}return!0}return!1}return!1},parseStyle:async(e,o,r,t)=>{if(!t)return"#000000";let s=t.split("://");if(s[0]==="gradient"){const a=o.gradientManager?.get(s.slice(1).join("://"));if(!a)return e.customError("No gradient");s=a}else if(s[0]==="pattern"){const a=s.slice(1).join("://").split(":"),i=a.shift()?.toLowerCase(),c=a.length>0&&["repeat","repeat-x","repeat-y","no-repeat"].includes(a[a.length-1])?a.pop():null;let l;if(i==="canvas"){const n=o.canvasManager?.get(c?a.join(":"):a.join())?.ctx;if(!n)return e.customError("No canvas with provided name found.");l=n.getImageData(0,0,n.canvas.width,n.canvas.height)}else if(i==="image")if(a?.join(":")?.startsWith("images://")){const n=o?.imageManager?.get(a.join(":").slice(9));if(!n)return e.customError("No image with provided name found.");l=n}else l=await(0,canvas_1.loadImage)(c?a.join(":"):a.join());else return e.customError("Invalid pattern type.");s=r.ctx.createPattern(l,c)}else s=(exports.hexRegex.test(t)?t:exports.rgbaRegex.test(t)?(()=>{const a=t.match(exports.rgbaRegex);return(0,gifsx_1.rgbaToHex)(Uint8Array.from([Number.parseInt(a[1],10),Number.parseInt(a[2],10),Number.parseInt(a[3],10),a[5]?Number.parseFloat(a[5]):255]),!1,!0)})():exports.Colors[t])??"#000000";return s},calculateRectAlignOrBaseline:(e,o,r)=>(r=typeof r=="string"?__1.RectAlign[r]:r,r===__1.RectAlign.center?e-o/2:r===__1.RectAlign.right||r===__1.RectBaseline.top?e-o:e),parseFilters:e=>{const o=[],r=/([a-zA-Z-]+)\(([^)]+)\)/g;let t;for(;(t=r.exec(e))!==null;){const[s,a,i]=t;o.push({filter:a,value:i,raw:s})}return o}},exports.Logger={DateColor:chalk_1.default.green.bold,Colors:{INFO:chalk_1.default.cyan.bold,WARN:chalk_1.default.yellow.bold,ERROR:chalk_1.default.red.bold,MESSAGE:chalk_1.default.cyan.bold},log(e,o){console.log(this.DateColor(`[${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}]`),this.Colors[e](`[${e}]`),this.Colors.MESSAGE(o))}};async function loadFrame(e,o){const r=await(0,canvas_1.loadImage)(e),t=(0,canvas_1.createCanvas)(r.width,r.height),s=t.getContext("2d");return s.drawImage(r,0,0),gifsx_1.Frame.fromRgba(t.width,t.height,Uint8Array.from(s.getImageData(0,0,t.width,t.height).data),o)}function parseArgs(e,o,r,t){const s=e.slice(typeof o=="string"?o.length:o).split(":");if(t?s.length<r:s.length!==r)throw new Error(`${o} frame expects ${r} arguments.`);return s}
