"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),canvas_1=require("@napi-rs/canvas"),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$drawImage",aliases:["$placeImage"],description:"Draws an image on a canvas.",version:"1.0.0",brackets:!0,unwrap:!0,args:[{name:"canvas",description:"Name of the canvas.",type:forgescript_1.ArgType.String,required:!1,rest:!1},{name:"path",description:"The image path.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"x",description:"The image start X coordinate.",type:forgescript_1.ArgType.Number,required:!0,rest:!1},{name:"y",description:"The image start Y coordinate.",type:forgescript_1.ArgType.Number,required:!0,rest:!1},{name:"width",description:"The image width.",type:forgescript_1.ArgType.Number,required:!1,rest:!1},{name:"height",description:"The image height.",type:forgescript_1.ArgType.Number,required:!1,rest:!1},{name:"radius",description:"The image radius.",type:forgescript_1.ArgType.Number,required:!1,rest:!0}],async execute(e,[i,a,d,h,f,y,n]){const o=i?e.canvasManager?.get(i):!i&&e.canvasManager?.current?.length!==0?e.canvasManager?.current?.[e.canvasManager?.current?.length-1]:null;if(!o)return this.customError("No canvas");let r=a;if(a.startsWith("frame://")){const t=e.gifManager?.getFrame(a.slice(8));if(!t)return this.customError("No frame");const{width:s,height:g,buffer:c}=t,m=(0,canvas_1.createCanvas)(s,g),u=m.getContext("2d"),p=u.createImageData(s,g);p.data.set(c.length===s*g*4?c:(0,gifsx_1.indexedToRgba)(Uint8Array.from(c),t.palette??Uint8Array.from([]),t.transparent)),u.putImageData(p,0,0),r=m.toBuffer("image/png")}else a.startsWith("images://")&&e.imageManager?r=e.imageManager.get(a.slice(9)):a.startsWith("canvas://")&&(r=e.canvasManager?.get(a.slice(9))?.buffer("image/png"));return r?(await o.drawImage(r,d,h,f,y,n.length===1?n[0]:n),this.success()):this.customError("Failed to load an image.")}});
