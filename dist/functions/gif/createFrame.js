"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),__1=require("../.."),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$createFrame",aliases:["$createGIFFrame","$newFrame","$newGIFFrame"],description:"Creates a new GIF Frame.",version:"1.2.0",brackets:!0,unwrap:!0,args:[{name:"frame",description:"Name of the new GIF Frame.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"src",description:"Source of the GIF Frame.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"options",description:"Options for the GIF Frame.",type:forgescript_1.ArgType.Json,required:!1,rest:!1},{name:"speed",description:"Frame rgb quantization speed.",type:forgescript_1.ArgType.Number,check:s=>s>=1&&s<=30,required:!1,rest:!1}],async execute(s,[g,a,e,f]){(!s.gifManager||!(s.gifManager instanceof __1.GIFManager))&&(s.gifManager=new __1.GIFManager);let r=null;if(a.startsWith("rgba://")){const[t,i]=(0,__1.parseArgs)(a,"rgba://",2),[n,m]=t.split("x").map(Number);r=gifsx_1.Frame.fromRgba(n,m,Uint8Array.from(i.split(",").map(Number)),f)}else if(a.startsWith("hex://")){const[t,i]=(0,__1.parseArgs)(a,"hex://",2),[n,m]=t.split("x").map(Number);r=gifsx_1.Frame.fromHex(n,m,i.split(",").map(l=>l.trim()),f)}else if(a.startsWith("rgb://")){const[t,i]=(0,__1.parseArgs)(a,"rgb://",2),[n,m]=t.split("x").map(Number);r=gifsx_1.Frame.fromRgb(n,m,Uint8Array.from(i.split(",").map(Number)),f)}else if(a.startsWith("indexed://")){const[t,i]=(0,__1.parseArgs)(a,"indexed://",2),[n,m]=t.split("x").map(Number);r=gifsx_1.Frame.fromIndexedPixels(n,m,Uint8Array.from(i.split(",").map(Number)))}else if(a.startsWith("images://")){const t=s.imageManager?.get(a.slice(9));if(!t)return this.customError("No image");r=await(0,__1.loadFrame)(t,f)}else if(a.startsWith("canvas://")){const t=s.canvasManager?.get(a.slice(9));if(!t)return this.customError("No canvas");r=gifsx_1.Frame.fromRgba(t.width,t.height,Uint8Array.from(t.ctx.getImageData(0,0,t.width,t.height).data),f)}else r=await(0,__1.loadFrame)(a,f);return r?(e&&(typeof e.delay=="number"&&(r.delay=e.delay),e.dispose&&gifsx_1.DisposalMethod[e.dispose]&&(r.dispose=e.dispose),typeof e.transparent=="number"&&(r.transparent=e.transparent),typeof e.needsUserInput=="boolean"&&(r.needsUserInput=e.needsUserInput),typeof e.top=="number"&&(r.top=e.top),typeof e.left=="number"&&(r.left=e.left),typeof e.interlaced=="boolean"&&(r.interlaced=e.interlaced),Array.isArray(e.palette)&&r.setPalette(Uint8Array.from(e.palette))),s.gifManager.setFrame(g,r),this.success()):this.customError("Invalid frame")}});
