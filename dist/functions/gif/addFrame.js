"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),__1=require("../.."),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$addFrame",description:"Adds a frame to the GIF.",version:"1.2.0",brackets:!0,unwrap:!0,args:[{name:"gif",description:"Name of the GIF.",type:forgescript_1.ArgType.String,required:!1,rest:!1},{name:"frame",description:"Frame source.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"options",description:"Frame options.",type:forgescript_1.ArgType.Json,required:!1,rest:!1},{name:"speed",description:"Frame rgb quantization speed.",type:forgescript_1.ArgType.Number,check:i=>i>=1&&i<=30,required:!1,rest:!1}],async execute(i,[m,s,r,p]){const g=m?i.gifManager?.getEncoder(m):!m&&i.gifManager?.currentEncoder?.length!==0?i.gifManager?.currentEncoder?.[i.gifManager?.currentEncoder?.length-1]:null;if(!g)return this.customError("No gif");let t;if(s.startsWith("rgba://")){const[e,a]=(0,__1.parseArgs)(s,"rgba://",2),[n,o]=e.split("x").map(Number);t=gifsx_1.Frame.fromRgba(n,o,Uint8Array.from(a.split(",").map(Number)),p)}else if(s.startsWith("hex://")){const[e,a]=(0,__1.parseArgs)(s,"hex://",2),[n,o]=e.split("x").map(Number);t=gifsx_1.Frame.fromHex(n,o,a.split(",").map(c=>c.trim()),p)}else if(s.startsWith("rgb://")){const[e,a]=(0,__1.parseArgs)(s,"rgb://",2),[n,o]=e.split("x").map(Number);t=gifsx_1.Frame.fromRgb(n,o,Uint8Array.from(a.split(",").map(Number)),p)}else if(s.startsWith("indexed://")){const[e,a]=(0,__1.parseArgs)(s,"indexed://",2),[n,o]=e.split("x").map(Number);t=gifsx_1.Frame.fromIndexedPixels(n,o,Uint8Array.from(a.split(",").map(Number)))}else if(s.startsWith("images://")){const e=i.imageManager?.get(s.slice(9));if(!e)return this.customError("No image");t=await(0,__1.loadFrame)(e,p)}else if(s.startsWith("frame://")){const e=i.gifManager?.getFrame(s.slice(8));if(!e)return this.customError("No frame");t=e}else if(s.startsWith("canvas://")){const e=i.canvasManager?.get(s.slice(9));if(!e)return this.customError("No canvas");t=gifsx_1.Frame.fromRgba(e.width,e.height,Uint8Array.from(e.ctx.getImageData(0,0,e.width,e.height).data),p)}else t=await(0,__1.loadFrame)(s);return t?(r&&(typeof r.delay=="number"&&(t.delay=r.delay),r.dispose&&gifsx_1.DisposalMethod[r.dispose]&&(t.dispose=r.dispose),typeof r.transparent=="number"&&(t.transparent=r.transparent),typeof r.needsUserInput=="boolean"&&(t.needsUserInput=r.needsUserInput),typeof r.top=="number"&&(t.top=r.top),typeof r.left=="number"&&(t.left=r.left),typeof r.interlaced=="boolean"&&(t.interlaced=r.interlaced),Array.isArray(r.palette)&&t.setPalette(Uint8Array.from(r.palette))),g.addFrame(t),this.success()):this.customError("Invalid frame")}});
