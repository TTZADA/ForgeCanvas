"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),__1=require("../.."),canvas_1=require("@napi-rs/canvas"),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$loadImage",aliases:["$createImage","$newImage"],description:"Loads an image.",version:"1.1.0",brackets:!0,unwrap:!0,args:[{name:"name",description:"The image name.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"src",description:"The image source.",type:forgescript_1.ArgType.String,required:!0,rest:!1}],async execute(r,[c,a]){(!r.imageManager||!(r.imageManager instanceof __1.ImageManager))&&(r.imageManager=new __1.ImageManager);let s;if(["rgba://","rgb://","hex://"].find(e=>a.startsWith(e))){const[e,t]=(0,__1.parseArgs)(a,a.split("//")[0].length+2,2),[n,i]=e.split("x").map(Number),g=(0,canvas_1.createCanvas)(n,i),o=g.getContext("2d"),m=o.createImageData(n,i);m.data.set(new Uint8ClampedArray(a.startsWith("hex://")?(0,gifsx_1.hexToRgba)(t.split(",").map(u=>u.trim())):a.startsWith("rgb://")?t.split(",").map(Number).flatMap((u,f)=>(f+1)%3===0?[u,255]:[u]):t.split(",").map(Number))),o.putImageData(m,0,0),s=g.toBuffer("image/png")}else if(a.startsWith("canvas://")){const e=r.canvasManager?.get(a.slice(9));if(!e)return this.customError("Invalid canvas");s=e.buffer}else if(a.startsWith("frame://")){const e=r.gifManager?.getFrame(a.slice(8));if(!e)return this.customError("No frame");const{width:t,height:n,buffer:i}=e,g=(0,canvas_1.createCanvas)(t,n),o=g.getContext("2d"),m=o.createImageData(t,n);m.data.set(i.length===t*n*4?i:(0,gifsx_1.indexedToRgba)(Uint8Array.from(i),e.palette??Uint8Array.from([]),e.transparent)),o.putImageData(m,0,0),s=g.toBuffer("image/png")}else s=a;return s?(r.imageManager.set(c,await(0,canvas_1.loadImage)(s)),this.success()):this.customError("Invalid source")}});
