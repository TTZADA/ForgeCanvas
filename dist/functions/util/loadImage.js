"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const forgescript_1=require("@tryforge/forgescript"),__1=require("../.."),canvas_1=require("@napi-rs/canvas"),gifsx_1=require("@gifsx/gifsx");exports.default=new forgescript_1.NativeFunction({name:"$loadImage",aliases:["$createImage","$newImage"],description:"Loads an image.",version:"1.1.0",brackets:!0,unwrap:!0,args:[{name:"name",description:"The image name.",type:forgescript_1.ArgType.String,required:!0,rest:!1},{name:"src",description:"The image source.",type:forgescript_1.ArgType.String,required:!0,rest:!1}],async execute(r,[p,a]){(!r.imageManager||!(r.imageManager instanceof __1.ImageManager))&&(r.imageManager=new __1.ImageManager);let s=null;if(["rgba://","rgb://","hex://"].find(e=>a.startsWith(e))){const[e,t]=(0,__1.parseArgs)(a,a.split("//")[0].length+2,2),[i,n]=e.split("x").map(Number),g=(0,canvas_1.createCanvas)(i,n),m=g.getContext("2d"),o=m.createImageData(i,n);o.data.set(new Uint8ClampedArray(a.startsWith("hex://")?(0,gifsx_1.hexToRgba)(t.split(",").map(c=>c.trim())):a.startsWith("rgb://")?t.split(",").map(Number).flatMap((c,u)=>(u+1)%3===0?[c,255]:[c]):t.split(",").map(Number))),m.putImageData(o,0,0),s=g.toBuffer("image/png")}else if(a.startsWith("canvas://")){const e=r.canvasManager?.get(a.slice(9));if(!e)return this.customError("Invalid canvas");s=e.buffer("image/png")}else if(a.startsWith("frame://")){const e=r.gifManager?.getFrame(a.slice(8));if(!e)return this.customError("No frame");const{width:t,height:i,buffer:n}=e,g=(0,canvas_1.createCanvas)(t,i),m=g.getContext("2d"),o=m.createImageData(t,i);o.data.set(n.length===t*i*4?n:(0,gifsx_1.indexedToRgba)(Uint8Array.from(n),e.palette??Uint8Array.from([]),e.transparent)),m.putImageData(o,0,0),s=g.toBuffer("image/png")}else s=a;return s?(r.imageManager.set(p,await(0,canvas_1.loadImage)(s)),this.success()):this.customError("Invalid source")}});
